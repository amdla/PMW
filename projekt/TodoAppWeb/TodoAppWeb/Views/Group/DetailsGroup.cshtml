<!-- DetailsGroup.cshtml -->
@model TodoAppWeb.Models.Group

<h1>@Model.Name</h1>

<ul class="list-group">
    @foreach (var task in Model.Tasks)
    {
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <!-- Task Name -->
            <span>@task.Title</span>

            <!-- Edit and Delete Buttons for Tasks -->
            <div>
                <a asp-action="EditTask" asp-controller="Task" asp-route-id="@task.TaskId"
                   class="btn btn-warning btn-sm">Edit</a>
                <button class="btn btn-danger btn-sm delete-task-btn" data-task-id="@task.TaskId">Delete</button>
            </div>
        </li>
    }
</ul>

<!-- JavaScript for Handling Task Deletion -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Handle task deletion
        document.querySelectorAll('.delete-task-btn').forEach(button => {
            button.addEventListener('click', async (e) => {
                const taskId = e.target.getAttribute('data-task-id');

                if (confirm('Are you sure you want to delete this task?')) {
                    try {
                        const response = await fetch(`/Task/DeleteTask?taskId=${taskId}`, {
                            method: 'POST'
                        });

                        if (response.ok) {
                            // Reload the page to reflect the changes
                            location.reload();
                        } else {
                            alert('Failed to delete the task.');
                        }
                    } catch (error) {
                        console.error('Error deleting task:', error);
                        alert('An error occurred while deleting the task.');
                    }
                }
            });
        });
    });
</script>